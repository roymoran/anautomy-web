<% provide(:title, "Search Results") %>

<style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 500px;
        width: 100%;
      }

    </style>

<!-- Page Content -->
    <div class="container-fluid mainContainerPadding">

        <div class="row">
            

            <div class="col-sm-6 left-col">
                 <div class = "container-fluid">
                    <h5 class = "newSearchTitle"> </h5>

<div class = "row">
    <div class="col-lg-12">
</div>

</div>
<ul class = "hiddenDataMessage">*To see details for all submissions, you must create a free account and submit at least once.</ul>
<div class = "submissionsRepairTitle">
<h5><ul><%= @repair_name %> for <%= @car %> - (<%= @final_submissions.count %> <%= "Submission".pluralize(@final_submissions.count)%>)</ul></h5>
</div>
<div class = "allSubissionsBlock container-fluid">

  <% @final_submissions.each do |s| %>
  <div class = "submissionBlock"> 
 
    <div class = "row">
   
    <div class = "col-md-3 col-md-offset-0 col-xs-8 col-xs-offset-2">
        <p class="text-center submissionBox">
          <span>Submission</span>
          <span class = "shopName"><%= s.shop.shop_name %> </span></p>
</div>
<div class = "col-md-6 col-md-offset-0 col-xs-8 col-xs-offset-2">
   <div class = "submission-title text-center"><%= CarYear.find(s.car.car_year_id).year %> <%= CarMake.find(s.car.car_make_id).name %> <%= CarModel.find(s.car.car_model_id).name%> - <%= number_to_currency(s.total_cost) %>
      </div>
    <p class="text-left review-text "></p>
</div>
<div class = "col-md-2 col-md-offset-0 col-xs-8 col-xs-offset-2">
    <p class="text-center submissionBlockPositioning"><span class = "rating star5"></span><span class = "reviewText"><a href = "#review">Read Review</a></span></p>
</div>
<div class = "col-md-1 col-md-offset-0 col-xs-12">
    <a class="btn demo_button_custom_submission  hidden-xs" href="#"><i class="fa fa-caret-right submissionRepairIcon"></i></a>
    <a class="btn demo_button_custom_submission_sm  visible-xs" href="#"><i class="fa fa-caret-right submissionRepairIcon"></i></a>
</div>
</div>
  </div>
  <% end %>

<% if @average_repair_cost != nil %>
<h6><i class="fa fa-caret-right fa-2x averageBarArrow"></i><span class = "averagePriceBarTitle">Average Price: <strong><%= number_to_currency(@average_repair_cost) %></strong></span><i class="fa fa-caret-left fa-2x averageBarArrow"></i></h6>
<% end %>


</div>
<br>
<br>
<br>

</div>
      </div>

<div class = "container-fluid">
  <div class = "col-sm-6 backgroundVehicleImage" style = "background: url(<%= @image_link %>) no-repeat center center; background-size: auto 100%;">
    <div class = "background_main_black_repairs">
      <div class = "row">
    <div id="map"></div>
        <div class = " topBlock col-lg-12 text-left">
          <h3 >Repair Details</h3>
        </div>
      </div>
      <div class = "row">
        <div class = "col-lg-12">
          <div class = "clutchImg">
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
          </div>
        </div>
      </div>
      <div class = "row">
      <div class = "col-lg-12">

        <div class = "col-xs-6" style = "padding-left:-5px;">
          <h5 class = "detailsHeader">DESCRIPTION</h5>
          <p class = "detailsDescription">- A critical component of your vehicle. It is used to engage and disengage the power transmission. Essentially,...<a href = "#moreinfo">read more</a></p>
          <h5 class = "detailsHeader">REPAIR/REPLACEMENT URGENCY</h5>
          <p class = "highUrgencyLevel detailsDescription">Very High</p>
          <h5 class = "detailsHeader">STANDARD REPLACEMENT TIME</h5>
          <p class = "detailsDescription">- 100,000 miles on BMW M3's, but this is highly variable on clutch shift time and driving style. Individuals experienced in driving manual transmission cars may see more lengevity from their clutch.</p>
        </div>
        <div class = "col-xs-6">
          <h5 class = "detailsHeader">STANDARD REPLACEMENT TIME</h5>
          <p class = "detailsDescription">- 100,000 miles on BMW M3's, but this is highly variable on clutch shift time and driving style. Individuals experienced in driving manual transmission cars may see more lengevity from their clutch.</p>
        </div>
    </div>
  </div>



    </div>
  </div>
</div>

  <!--<p class="repairCostBox"><span>Owner Rating</span><span class = "repairCostBoxPrice">4.5/5</span></p>
                        <p class="repairCostBox"><span>Maintenance Rating</span><span class = "repairCostBoxPrice">$$$</span></p>
                        <p class="repairCostBox"><span>5 year cost to own</span><span class = "repairCostBoxPrice">145,000</span></p>
                        <p class="repairCostBox"><span>Enter Miles for Average KBB Value</span><span class = "repairCostBoxPrice">KBB Value: $11,536</span></p>-->
        </div>
        <!-- /.row -->
    </div>

<!-- jQuery Version 1.11.1 -->

    <!-- <script src="!inc/js/jquery-2.1.0.min.js"></script> -->

    <%= javascript_include_tag "jquery.js" %>

    <%= javascript_include_tag "jquery-ui.js" %>

    <%= javascript_include_tag "https://maps.googleapis.com/maps/api/js?key="+ @google_api_key +"&libraries=places&callback=initMap", defer: true, async: true %>

<script>
var map;
var infowindow;

  function initMap() {
    var location = {lat: <%= @location["lat"] %>, lng: <%= @location["lng"] %>};
    var mapelement = document.getElementById('map');
    map = new google.maps.Map(mapelement, {
          center: location,
          zoom: 15
        });
    
    var request = {
      location: location,
      radius: '1000',
      type: ['car_repair']
    };

    infowindow = new google.maps.InfoWindow();
    
    var service = new google.maps.places.PlacesService(map);
    service.nearbySearch(request, callback);
  }

  
  function callback(results, status) {
    var submissionsBlock = document.getElementsByClassName('allSubissionsBlock')[0];
    if (status === google.maps.places.PlacesServiceStatus.OK) {
      for (var i = 0; i < results.length; i++) {
        submissionsBlock.insertAdjacentHTML('beforeend', '<div class = "submissionBlock"> <div class = "row"><div class = "col-md-3 col-md-offset-0 col-xs-8 col-xs-offset-2"> <p class="text-center submissionBox"> <span>Submission</span> <span class = "shopName">'+results[i].name+' </span></p></div><div class = "col-md-6 col-md-offset-0 col-xs-8 col-xs-offset-2"><div class = "submission-title text-center"> </div><p class="text-left review-text "></p></div><div class = "col-md-2 col-md-offset-0 col-xs-8 col-xs-offset-2"><p class="text-center submissionBlockPositioning"><span class = "rating star5"></span><span class = "reviewText"><a href = "#review">Read Review</a></span></p></div><div class = "col-md-1 col-md-offset-0 col-xs-12"><a class="btn demo_button_custom_submission  hidden-xs" href="#"><i class="fa fa-caret-right submissionRepairIcon"></i></a><a class="btn demo_button_custom_submission_sm  visible-xs" href="#"><i class="fa fa-caret-right submissionRepairIcon"></i></a></div></div></div>');
        createMarker(results[i]);
      }
    }
  }

function createMarker(place) {
  var placeLoc = place.geometry.location;
  var marker = new google.maps.Marker({
    map: map,
    position: place.geometry.location
  });
  google.maps.event.addListener(marker, 'click', function() {
    infowindow.setContent(place.name);
    infowindow.open(map, this);
  });
}
//Following line for chrome debugging purposes
//# sourceURL=googlePlaceResults.js 
</script>
